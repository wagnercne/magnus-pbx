; ============================================
; MAGNUS PBX - PJSIP Configuration
; Asterisk 22.8.2 Multi-tenant Realtime
; ============================================

[global]
type=global
user_agent=Magnus-PBX-Asterisk22
max_forwards=70
keep_alive_interval=90
contact_expiration_check_interval=30

; ============================================
; SYSTEM CONFIGURATION
; ============================================
[system]
type=system
; Ajuste de memória para PJSIP Realtime com 1.000+ tenants
timer_t1=500
timer_b=32000
threadpool_initial_size=10
threadpool_auto_increment=5
threadpool_idle_timeout=60
threadpool_max_size=50
disable_tcp_switch=yes

; ============================================
; TRANSPORT - UDP (Compartilhado)
; ============================================
; Este transport é usado por TODOS os tenants
; Mais eficiente que ter um transport por tenant no banco

[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060
; Se o Asterisk está atrás de NAT, configure:
; external_media_address=SEU_IP_PUBLICO
; external_signaling_address=SEU_IP_PUBLICO
; local_net=192.168.0.0/16

; ============================================
; TRANSPORT - WebRTC (WSS)
; ============================================
[transport-wss]
type=transport
protocol=wss
bind=0.0.0.0:8089

; ============================================
; REALTIME ENDPOINTS, AUTHS, AORS
; ============================================
; Os endpoints são carregados do banco de dados PostgreSQL.
; Veja sorcery.conf e extconfig.conf para o mapeamento.
;
; Estrutura no banco:
; - ID formato: ramal@slug (ex: 1001@belavista)
; - Context: ctx-slug (ex: ctx-belavista)
; - Transport: transport-udp (definido acima)
;
; Exemplo de registro no banco:
; INSERT INTO ps_endpoints (id, transport, aors, auth, context) VALUES
; ('1001@belavista', 'transport-udp', '1001@belavista', '1001@belavista', 'ctx-belavista');
; ============================================
