; ============================================
; MAGNUS PBX - Sorcery Configuration
; ============================================
; Sorcery é o sistema de configuração dinâmica do Asterisk.
; Ele permite carregar objetos de diferentes fontes (arquivo, realtime, etc).
;
; Para PJSIP Realtime multi-tenant, configuramos:
; - endpoints, auths, aors do banco de dados
; - Cada tenant tem seus próprios registros
; ============================================

[res_pjsip]
; PJSIP usa Realtime para carregar configurações do PostgreSQL
endpoint=realtime,ps_endpoints
auth=realtime,ps_auths
aor=realtime,ps_aors
; transport definido em pjsip.conf (realtime não funciona bem)
contact=realtime,ps_contacts
; Domain alias para matching multi-tenant dinâmico
; ps_domain_aliases.domain = o que o softphone usa como servidor SIP
; ps_domain_aliases.id     = o slug do tenant (parte após @ no endpoint id)
; Fluxo: softphone usa belavista.magnussystem.com.br → alias id=belavista → endpoint 1001@belavista
domain_alias=realtime,ps_domain_aliases
identify=realtime,ps_identify

[res_pjsip_endpoint_identifier_ip]
identify=realtime,ps_identify

; ============================================
; NOTA IMPORTANTE SOBRE TRANSPORTS
; ============================================
; Se você tem muitos tenants usando o MESMO transport,
; é mais eficiente definir transports no pjsip.conf:
;
; [transport-udp]
; type=transport
; protocol=udp
; bind=0.0.0.0:5060
;
; Apenas endpoints, auths e aors precisam estar no banco.
; Transports podem ser estáticos no arquivo.
; ============================================
