; ============================================
; MAGNUS PBX - Master Dialplan
; Asterisk 22.8.2 + PostgreSQL Realtime
; ============================================
;
; ESTRUTURA MODULAR:
; - extensions-features.conf → Feature codes (*43, *97, *500, etc)
; - routing.conf → Sub-rotinas de discagem (dial-internal, dial-outbound, etc)
; - tenants.conf → Contextos dos tenants (ctx-belavista, ctx-acme, etc)
;
; Benefícios:
; ✓ Organização clara por responsabilidade
; ✓ Fácil manutenção e debug
; ✓ Adicionar novos tenants sem modificar lógica
; ✓ Features isolados para testes
;
; ============================================

[general]
static=yes
writeprotect=no
clearglobalvars=no

[globals]
; Variáveis globais
MAGNUS_VERSION=2.0.0
BACKEND_API=http://backend:5000/api

; ============================================
; INCLUDES - Arquivos Modulares
; ============================================

#include extensions-features.conf
#include routing.conf
#include tenants.conf

; ============================================
; CONTEXTO PADRÃO (Fallback)
; ============================================
[default]
exten => _X.,1,NoOp(=== Unrouted Call: ${EXTEN} ===)
 same => n,NoOp(Channel: ${CHANNEL})
 same => n,NoOp(Endpoint: ${CHANNEL(endpoint)})
 same => n,Answer()
 same => n,Playback(ss-noservice)
 same => n,Hangup()

; ============================================
; HINTS PARA BLF (Busy Lamp Field)
; ============================================
; Os hints permitem monitorar status de ramais
; Para multi-tenant, gere dinamicamente via script
; Exemplo:
; exten => 1001@belavista,hint,PJSIP/1001@belavista
; exten => 1002@belavista,hint,PJSIP/1002@belavista
